<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½ç»‘å®šç®¡ç†</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f8f9fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { margin-bottom: 20px; color: #333; }
        .controls { margin-bottom: 20px; padding: 15px; background: #e9ecef; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; }
        .search-box { padding: 8px; border: 1px solid #ced4da; border-radius: 4px; width: 200px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6; }
        th { background-color: #f1f3f5; font-weight: 600; color: #495057; }
        tr:hover { background-color: #f8f9fa; }
        
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .status-online { background-color: #d4edda; color: #155724; }
        .status-offline { background-color: #e2e3e5; color: #383d41; }
        
        .toggle-label { cursor: pointer; display: flex; align-items: center; }
        .toggle-label input { margin-right: 8px; }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¥ï¸ å·¥ä½çŠ¶æ€ç›‘æ§</h1>
        
        <div class="controls">
            <div>
                <input type="text" id="searchInput" class="search-box" placeholder="æœç´¢å·¥ä½æˆ–å§“å..." onkeyup="filterTable()">
            </div>
            <label class="toggle-label">
                <input type="checkbox" id="showEmptyOnly" onchange="filterTable()">
                åªæ˜¾ç¤ºç©ºé—²å·¥ä½ (æ— äºº/ç¦»çº¿)
            </label>
        </div>

        <table id="seatTable">
            <thead>
                <tr>
                    <th>å·¥ä½å·</th>
                    <th>çŠ¶æ€</th>
                    <th>å½“å‰/æœ€åç”¨æˆ·</th>
                    <th>ä¸»æœºå</th>
                    <th>æœ€åæ´»è·ƒæ—¶é—´</th>
                    <th>æ˜¾ç¤ºå™¨ SN</th>
                </tr>
            </thead>
            <tbody>
                {% for item in mappings %}
                <tr class="seat-row" data-status="{{ 'online' if item.last_user and item.last_user.is_active else 'offline' }}">
                    <td style="font-weight: bold; font-size: 1.1em;">{{ item.seat_id }}</td>
                    <td>
                        {% if item.last_user and item.last_user.is_active %}
                            <span class="status-badge status-online">ğŸŸ¢ åœ¨çº¿</span>
                        {% else %}
                            <span class="status-badge status-offline">âšªï¸ ç©ºé—²</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.last_user %}
                            {{ item.last_user.user_name }}
                        {% else %}
                            <span style="color: #999;">(ä»æœªç»‘å®šç”¨æˆ·)</span>
                        {% endif %}
                    </td>
                    <td>{{ item.last_user.host_name if item.last_user else '-' }}</td>
                    <td>{{ item.last_user.last_seen if item.last_user else '-' }}</td>
                    <td style="font-family: monospace; color: #666;">{{ item.monitor_sn }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <p style="text-align: right; color: #999; margin-top: 20px; font-size: 0.9em;">å…± {{ mappings|length }} ä¸ªå·¥ä½</p>
    </div>

    <script>
        function filterTable() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const showEmptyOnly = document.getElementById('showEmptyOnly').checked;
            const rows = document.querySelectorAll('.seat-row');

            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                const status = row.getAttribute('data-status');
                
                // 1. æœç´¢åŒ¹é…
                const matchesSearch = text.includes(searchText);
                
                // 2. ç©ºé—²ç­›é€‰ (å¦‚æœæ˜¯ 'online' ä¸”å‹¾é€‰äº†åªçœ‹ç©ºé—²ï¼Œåˆ™åº”éšè—)
                let matchesFilter = true;
                if (showEmptyOnly && status === 'online') {
                    matchesFilter = false;
                }

                if (matchesSearch && matchesFilter) {
                    row.classList.remove('hidden');
                } else {
                    row.classList.add('hidden');
                }
            });
        }
    </script>
</body>
</html>
